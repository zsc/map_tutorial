<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="./">
    <title>第 1 章：地图世界观——从地球到屏幕</title>
    <link rel="stylesheet" href="assets/style.css">
    <link rel="stylesheet" href="assets/highlight.css">
    <script src="assets/script.js" defer></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']],
                processEscapes: false,
                packages: {'[+]': ['noerrors', 'ams']}
            },
            options: {
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            loader: {
                load: ['[tex]/noerrors', '[tex]/ams']
            }
        };
    </script>
</head>
<body>
    <div class="container">
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h3>目录</h3>
                <button id="sidebar-toggle" class="sidebar-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
            <div class="sidebar-search">
                <input type="text" id="sidebar-search-input" placeholder="搜索..." autocomplete="off">
            </div>
            <div id="tree-container">
                <nav class="tree-nav" role="tree">
                    <div class="tree-item " >
                        <a href="index.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">全球地图：矢量、影像、地形</span>
                        </a>
                    </div>
                
                    <div class="tree-item active" >
                        <a href="chapter1.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第 1 章：地图世界观——从地球到屏幕</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter2.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第 2 章：矢量地图基础与空间分析</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter3.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第 3 章：栅格影像与遥感入门（含多光谱）</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter4.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第 4 章：DEM 与地形分析基础</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter5.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第 5 章：在线底图与天地图生态</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter6.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第 6 章：吉林一号影像与“全国一张图 / 全球一张图”</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter7.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">[第 7 章：NOAA、Sentinel 等开源卫星数据应用](chapter7.md)</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter8.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第 8 章：SAR 影像与多光谱影像进阶</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter9.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第 9 章：从 nadir 到三维——立体像对、倾斜与点云</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter10.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第 10 章：从三维到街景——采集流程与 Street View API</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter11.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第 11 章：室内地图构建与 BIM 融合</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter12.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第 12 章：多尺度地图发布——从全球到底层室内</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter13.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第 13 章：综合项目与扩展方向——构建数字孪生世界</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="CLAUDE.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                </nav>
            </div>
        </nav>
        
        <main class="content">
            <article>
                <h1 id="1">第 1 章：地图世界观——从地球到屏幕</h1>
<h2 id="1_1">1. 开篇</h2>
<p>当我们打开 Google Maps 或天地图，输入目的地开始导航时，屏幕上流畅滑动的地图背后，隐藏着人类数百年来试图解决的一个核心矛盾：<strong>如何在一个平面的、有限的屏幕上，精确描述一个不规则的、三维的地球？</strong></p>
<p>这一章不是枯燥的地理课，而是构建数字地图系统的底层物理逻辑。如果不理解底层的“参考系”与“投影”，你后续制作的地图可能会出现数百米的偏差，或者在计算面积时产生巨大的谬误。我们将从大地测量学的基本原理出发，一路推演到现代互联网地图通用的“瓦片金字塔”模型。</p>
<p><strong>本章学习目标：</strong></p>
<ol>
<li><strong>破解地球形状</strong>：深入理解大地水准面 (Geoid) 与参考椭球 (Ellipsoid) 的物理意义与工程妥协。</li>
<li><strong>掌控坐标系</strong>：彻底厘清基准面 (Datum) 的作用，以及 EPSG:4326 与 EPSG:3857 的本质区别。</li>
<li><strong>数据二元论</strong>：从数据结构层面剖析矢量与栅格的优劣，以及它们在存储与计算上的权衡。</li>
<li><strong>多尺度思维</strong>：掌握 Web 地图的“瓦片模型” (Tile Pyramid) 与四叉树索引，理解分辨率 (GSD) 与缩放级别 (Zoom) 的数学关系。</li>
<li><strong>建立空间直觉</strong>：学会判断什么是“投影变形”，并在 GIS 软件中建立正确的工程环境。</li>
</ol>
<hr />
<h2 id="2">2. 核心论述</h2>
<h3 id="21">2.1 地球的真身：不规则的“土豆”与数学的妥协</h3>
<p>地球并不是圆的，甚至不是一个标准的椭球。由于地壳密度不均，地球各处的重力场并不一致。</p>
<h4 id="211-the-geoid">2.1.1 大地水准面 (The Geoid)</h4>
<p>如果我们移除潮汐和风浪的影响，让海水在重力作用下静止并延伸穿过陆地，形的一个封闭曲面，就是<strong>大地水准面</strong>。</p>
<ul>
<li><strong>物理意义</strong>：它是重力的等势面。在这个面上，水不会流动。</li>
<li><strong>形状</strong>：极其不规则，像一个坑坑洼洼的土豆。在印度洋南部有个大坑，在北大西洋有个凸起。</li>
<li><strong>作用</strong>：它是测量<strong>海拔高程</strong>（MSL, Mean Sea Level）的基准零点。</li>
</ul>
<h4 id="212-reference-ellipsoid">2.1.2 参考椭球体 (Reference Ellipsoid)</h4>
<p>大地水准面太复杂，无法用简单的数学公式描述。为了进行 GPS 定位和地图绘制，我们必须用一个规则的旋转椭球去拟合它。</p>
<ul>
<li><strong>参数</strong>：由长半轴 $a$（赤道半径）和扁率 $f$ 定义。</li>
<li><strong>WGS84 椭球</strong>：目前全球定位系统（GPS）使用的标准。<ul>
<li>长半轴 $a \approx 6,378,137.0$ 米</li>
<li>扁率 $f \approx 1/298.257223563$</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>Rule of Thumb (经验法则) —— 高程的陷阱</strong>：
GPS 接收机（如手机）原生测量的通常是“椭球高”（相对于 WGS84 椭球面的高度）。而我们在地图上看到的、以及工程测量中使用的通常是“海拔高”（相对于大地水准面）。
$$ \text{椭球高} = \text{海拔高} + \text{大地水准面差距 (Geoid Height)} $$
两者在全球范围内的差异可达 -100米 到 +80米。<strong>做无人机航测或地形分析时，必须确认高程基准！</strong></p>
</blockquote>
<hr />
<h3 id="22">2.2 坐标系：给地球穿上经纬网</h3>
<h4 id="221-datum">2.2.1 基准面 (Datum) —— 坐标系的“锚点”</h4>
<p>仅仅有椭球是不够的，我们还需要把这个椭球“固定”在地球的某个位置。</p>
<ul>
<li><strong>地心基准面</strong>：椭球中心与地球质心重合（如 WGS84, NAD83）。适合全球地图。</li>
<li><strong>区域基准面</strong>：为了让某个特定区域（如北京或东京）拟合得更准，人为移动椭球球心，使其表面紧贴该区域的大地水准面（如北京54坐标系）。</li>
</ul>
<blockquote>
<p><strong>关键概念</strong>：如果你把 WGS84 的经纬度直接套用到使用“北京54”基准面的地图上，可能会产生几十米甚至上百米的偏移。这就叫 <strong>Datum Shift</strong>。</p>
</blockquote>
<h4 id="222-projection">2.2.2 投影 (Projection) —— 撕开橘子皮</h4>
<p>将三维球面转换到二维平面的过程叫投影。<strong>所有投影都会变形</strong>，只是选择保留什么属性（面积、角度、距离）的权衡。</p>
<p><strong>Web 地图的霸主：Web Mercator (EPSG:3857)</strong>
Google Maps 在 2005 年做出了一个改变世界的决定：使用墨卡托投影。</p>
<ul>
<li><strong>正形性 (Conformality)</strong>：它保留了角度。如果你在路口需要转弯 90 度，地图上画的也是 90 度。这对于导航至关重要。</li>
<li><strong>计算效率</strong>：它将世界裁剪为一个正方形。赤道周长 $\approx 40,075$ km，它强行把纬度限制在 $\approx \pm 85.05^\circ$，使得 Y 轴长度等于赤道周长。</li>
<li><strong>巨大的代价</strong>：面积严重扭曲。格陵兰岛（216万 $km^2$）在地图上看起来和非洲（3037万 $km^2$）一样大。</li>
</ul>
<p><strong>ASCII 图解：Web Mercator 的网格变形</strong></p>
<div class="codehilite"><pre><span></span><code>纬度 60度 |  +------+------+  &lt;-- 实际地面长度只有赤道的一半，
          |  |      |      |      但在图上被拉成同样宽度。
          |  | Grid | Grid |      (面积放大 4 倍)

          |  | Grid | Grid |      (面积放大 4 倍)
          |  |      |      |
赤道 0度  |  +------+------+  &lt;-- 基准宽度
          |  |      |      |
          |  |      |      |
          |  WGS84 (Lon) -&gt; 
</code></pre></div>

<h4 id="223-epsg">2.2.3 常用 EPSG 代码速查</h4>
<p>OGP（油气生产商协会）维护了一个庞大的参数注册表，称为 EPSG 代码。</p>
<ul>
<li><strong>EPSG:4326</strong>: WGS84 地理坐标系。单位：度。<strong>（存储数据的通用语）</strong></li>
<li><strong>EPSG:3857</strong>: Web Mercator 投影坐标系。单位：米。<strong>（Web 展示的通用语）</strong></li>
<li><strong>EPSG:326xx / 327xx</strong>: UTM 投影。将地球切成 60 个竖条，精度高，变形小。<strong>（工程测量、无人机高精度制图首选）</strong></li>
</ul>
<hr />
<h3 id="23-vs">2.3 描述世界的两种语言：矢量 vs 栅格</h3>
<p>GIS 数据的本质只有两种：离散的对象与连续的场。</p>
<h4 id="231-vector">2.3.1 矢量数据 (Vector)</h4>
<p>用数学几何描述世界。</p>
<ul>
<li><strong>模型</strong>：<ul>
<li><strong>点 (Point)</strong>：POI、树木、路灯。（0维）</li>
<li><strong>线 (LineString)</strong>：道路、流中线、轨迹。（1维）</li>
<li><strong>面 (Polygon)</strong>：建筑物轮廓、行政区划、湖泊。（2维）</li>
</ul>
</li>
<li><strong>拓扑关系 (Topology)</strong>：矢量的高级形态。不仅记录“在哪里”，还记录“谁和谁相连”、“谁在谁左边”。这对于路径规划（导航）至关重要。</li>
<li><strong>优势</strong>：无限缩放不失真，数据量小，易于属性查询（SQL 查询）。</li>
<li><strong>劣势</strong>：难以表达渐变现象（如空气污染扩散）。</li>
</ul>
<h4 id="232-raster">2.3.2 栅格数据 (Raster)</h4>
<p>将世界离散化为规则的网格矩阵。</p>
<ul>
<li><strong>像素 (Pixel)</strong>：每个格子存储一个或多个数值。</li>
<li><strong>波段 (Bands)</strong>：<ul>
<li>普通照片：3个波段 (Red, Green, Blue)。</li>
<li>DEM (高程)：1个波段 (存储高度值，通常是 Float32 或 Int16)。</li>
<li>卫星影像：可能有 4 个（含近红外）、8 个甚至上百个波段（高光谱）。</li>
</ul>
</li>
<li><strong>优势</strong>：完美表达连续变化的现象，是卫星遥感和计算机视觉的基础。</li>
<li><strong>劣势</strong>：数据量巨大（随分辨率平增长），放大有马赛克，难以进行“对象级”查询。</li>
</ul>
<hr />
<h3 id="24-tile-pyramid">2.4 瓦片金字塔 (Tile Pyramid) 与 四叉树</h3>
<p>为了在浏览器上流畅加载全球 PB 级的影像数据，我们不能一次性传输整个文件。我们使用“分治法”。</p>
<h4 id="241-quadtree">2.4.1 四叉树切分 (Quadtree)</h4>
<ol>
<li><strong>Level 0</strong>: 全球是一张 $256 \times 256$ 像素的图片。</li>
<li><strong>切分</strong>: 每一级将上一级的 1 张图片切成 $2 \times 2 = 4$ 张。</li>
<li><strong>索引</strong>: 通常使用 XYZ 索引法。<ul>
<li>$Z$: 缩放级别 (Zoom Level)</li>
<li>$X$: 列号</li>
<li>$Y$: 行号</li>
</ul>
</li>
</ol>
<p><strong>数量级爆炸</strong>：</p>
<ul>
<li>Zoom 0: 1 张瓦片</li>
<li>Zoom 10: $4^{10} \approx 100$ 万张瓦片</li>
<li>Zoom 20: $4^{20} \approx 1$ 万亿张瓦片
这就是为什么我们需要“按需加载”技术。</li>
</ul>
<h4 id="242-gsd">2.4.2 像素分辨率 (GSD) 计算公式</h4>
<p>理解这一公式对于选择购买什么精度的卫星影像至关重要。
在 Web Mercator 投影下，赤道附近的地面分辨率 $Res$ (米/像素) 为：
$$ Res = \frac{2 \pi a}{T \cdot 2^z} $$</p>
<p>其中：</p>
<ul>
<li>$a = 6378137$ (地球半径)</li>
<li>$T = 256$ (瓦片默认尺寸)</li>
<li>$z$ = Zoom Level</li>
</ul>
<p><strong>典型尺度速查表</strong>：
| Zoom | 分辨率 (赤道) | 适用场景 | 对应数据源 |</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Zoom</th>
<th style="text-align: left;">分辨率 (赤道)</th>
<th style="text-align: left;">适用场景</th>
<th style="text-align: left;">对应数据源</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>0-5</strong></td>
<td style="text-align: left;">&gt; 4 km</td>
<td style="text-align: left;">洲际概览、气象云图</td>
<td style="text-align: left;">NASA Blue Marble, NOAA</td>
</tr>
<tr>
<td style="text-align: left;"><strong>10</strong></td>
<td style="text-align: left;">~ 150 m</td>
<td style="text-align: left;">城市分布、大型路网</td>
<td style="text-align: left;">Landsat 卫星</td>
</tr>
<tr>
<td style="text-align: left;"><strong>14</strong></td>
<td style="text-align: left;">~ 9.5 m</td>
<td style="text-align: left;">街区辨识</td>
<td style="text-align: left;">Sentinel-2 (10m)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>18</strong></td>
<td style="text-align: left;">~ 0.6 m</td>
<td style="text-align: left;">辨识车辆、道路标线</td>
<td style="text-align: left;">吉林一号, Maxar</td>
</tr>
<tr>
<td style="text-align: left;"><strong>20</strong></td>
<td style="text-align: left;">~ 0.15 m</td>
<td style="text-align: left;">辨识人行道地砖、井盖</td>
<td style="text-align: left;">无人机航测, 街景投影</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Rule of Thumb (经验法则)</strong>：
如果你的项目需要识别路面上的<strong>井盖</strong>，你需要优于 15cm (Zoom 20+) 的分辨率。如果你只需要看<strong>农田边界</strong>，Sentinel-2 的 10m (Zoom 14) 通常就够了，且它是免费的。不要花冤枉钱买过高精度的数。</p>
</blockquote>
<hr />
<h2 id="3">3. 本章小结</h2>
<ol>
<li><strong>物理基础</strong>：地球是物理上的不规则体（大地水准面），数学上的椭球体（WGS84），展示时的平面图（Web Mercator）。</li>
<li><strong>坐标转换</strong>：EPSG:4326 是“世界语”（经纬度），EPSG:3857 是“屏幕语”（米）。所有的 Web 地图开发都在这两者之间不断转换。</li>
<li><strong>数据选择</strong>：边界明确选矢量，连续变化选栅格。</li>
<li><strong>瓦片机制</strong>：地图通过四叉树金字塔组织，每深一层，数据量翻 4 倍，分辨率精细 1 倍。</li>
<li><strong>核心公式</strong>：记住赤道周长约 40,000 公里。Zoom 0 时，1 像素代表 $\approx 156$ 公里。</li>
</ol>
<hr />
<h2 id="4-gotchas">4. 常见陷阱与错误 (Gotchas)</h2>
<h3 id="1_2">陷阱 1：小数点的虚假精度</h3>
<p>初学者常保留经纬度到小数点后 10 位。</p>
<ul>
<li><strong>事实</strong>：<ul>
<li>1 度 $\approx$ 111 km</li>
<li>0.000001 度 ($10^{-6}$) $\approx$ 0.1 米 (10 厘米)</li>
<li>0.00000001 度 ($10^{-8}$) $\approx$ 1 毫米</li>
</ul>
</li>
<li><strong>建议</strong>：对于一般的 Web 地图应用（如定位车辆），保留 6 位小数（约 10cm 精度）已绰绰有余。存储过高精度只会浪费带宽和存储空间。</li>
</ul>
<h3 id="2wgs84-gcj-02">陷阱 2：WGS84 与 GCJ-02 (火星坐标) 的混淆</h3>
<p>在中国大陆进行地图开发，不可避免会遇到“坐标偏移”问题。</p>
<ul>
<li><strong>现象</strong>：卫星影像（真实的 WGS84）与街道矢量（经过加密的 GCJ-02）叠加时，会有数百米的错位。</li>
<li><strong>对策</strong>：必须明确数据源的坐标系。<ul>
<li><strong>天地图</strong>：通常提供 WGS84 (CGCS2000) 和 Web Mercator 两种服务。</li>
<li><strong>高德/腾讯</strong>：使用 GCJ-02。</li>
<li><strong>百度</strong>：使用 BD-09 (在 GCJ-02 基础上二次加密)。</li>
<li><strong>处理</strong>：在叠加前，必须使用纠偏算法将它们统一转换到同一坐标系（通常统一转为 WGS84 进行空间分析，展示时再按需转换）。</li>
</ul>
</li>
</ul>
<h3 id="3-web-mercator">陷阱 3：在 Web Mercator 上画圆</h3>
<p>如果你在 EPSG:3857 地图上以某点为中心，画一个半径 10km 的“正圆”缓冲区（Buffer）。</p>
<ul>
<li><strong>结果</strong>：在屏幕上它是圆的，但转换回地球表面，它其实是一个椭圆（高纬度地区）。</li>
<li><strong>反之</strong>：如果你在地球表面画一个真实的 10km 圆，投影到 Web Mercator 地图上，它看起来是椭圆的。</li>
<li><strong>建议</strong>：进行“缓冲区分析”等空间计算时，务必使用支持测地线（Geodesic）计算的库，或者投影到当地的 UTM 坐标系下进行几何运算。</li>
</ul>
<h3 id="4">陷阱 4：栅格的“金字塔”不是免费的</h3>
<p>在 GIS 软件（如 QGIS, ArcGIS）或服务器（GeoServer）中发布栅格数据时，如果不预先构建“金字塔”（Overviews）。</p>
<ul>
<li><strong>后果</strong>：每次缩放浏览，软件都要读取整个巨大的原始 TIFF 文件并实时重采样，导致软件卡死或服务器崩溃。</li>
<li><strong>最佳实践</strong>：任何大于 100MB 的栅格影像，拿到手的第一件事就是构建金字塔（Build Overviews）或转换为 COG (Cloud Optimized GeoTIFF)。</li>
</ul>
            </article>
            
            <nav class="page-nav"><a href="index.html" class="nav-link prev">← 全球地图：矢量、影像、地形</a><a href="chapter2.html" class="nav-link next">第 2 章：矢量地图基础与空间分析 →</a></nav>
        </main>
    </div>
</body>
</html>